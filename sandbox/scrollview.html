<!DOCTYPE HTML>
<html>
  <head>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="user-scalable=no, width=device-width">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-transparent">
    <style>
      body
      {
        padding: 0;
        margin: 0;
        background-color: #333;
      }
      .demo
      {
        font: 16pt georgia;
      }
      #wrapper
      {
        position:relative;
        z-index:1;
        width: 768px;
        height: 1004px;
      }
      #scroller
      {
        background-color: #333;
        padding: 0px;
        position: relative;
        margin: 0;
      }
      #scroller .ui-scrollview-item
      {
        position: absolute;
        line-height: 250px;
        width: 256px;
        text-align: center;
      }
      
      #scroller .ui-scrollview-item img
      {
        display: inline-block;
        vertical-align: middle;
        -webkit-transform: translate3d(0,0,0);
        -webkit-box-shadow: 0 2px 5px rgba(0,0,0,0.5);
      }
      
    </style>
    <script src="../build/debug/distil-sync.js" type="text/javascript" charset="utf-8"></script>
    <script src="../build/debug/coherent-debug.js" type="text/javascript" charset="utf-8"></script>
    <script src="../build/debug/src/controls/ScrollView.js" type="text/javascript" charset="utf-8"></script>
  </head>
    
  <body>
    <div class="demo">
      <div id="wrapper">
        <div id="scroller">
        </div>
      </div>
    </div>
    
    <script>
      var GRID_SIZE_H= 256;
      var GRID_SIZE_V= 250;
      
      function createPhotos(w, h, maxPhotoIndex)
      {
        var x, y;
        var item;
        var photos= [];
        var photoIndex;
        
        for (y=0; y<h; y++)
          for (x=0; x<w; x++)
          {
            photoIndex= y*w +x + 1;
          
            photos.push({
              src: "photos/photo-" + (photoIndex<10 ? ('0'+photoIndex) : photoIndex) + ".png",
              x: x * GRID_SIZE_H,
              y: y * GRID_SIZE_V,
              w: GRID_SIZE_H,
              h: GRID_SIZE_V
            });
          }
        
        return photos;
      }

      function createPhotosAlt(count, maxPhotoIndex)
      {
        var x, y;
        var divisor= Math.ceil(Math.sqrt(count));
        var item;
        var photos= [];
        var photoIndex;
        var container= document.getElementById('scroller');
        var node;
        var HAS_3D= coherent.Support.CssMatrix,
            TRANSLATE_OPEN = 'translate' + (HAS_3D ? '3d(' : '('),
            TRANSLATE_CLOSE = HAS_3D ? ',0)' : ')';

        var template= document.createElement('div');
        template.className= 'ui-scrollview-item';
        var img= document.createElement('img');
        template.appendChild(img);
        var style= template.style;
        style.webkitTransitionProperty = '-webkit-transform';
        style.webkitTransitionTimingFunction = 'cubic-bezier(0,0,0.25,1)';
        style.webkitTransitionDuration = '0';
        style.webkitTransform = TRANSLATE_OPEN + '0,0' + TRANSLATE_CLOSE;

        for (var i=0; i<count; ++i)
        {
          x= Math.floor(i/divisor) * GRID_SIZE_H;
          y= i%divisor * GRID_SIZE_V;
          photoIndex= (i % maxPhotoIndex) + 1;
          
          node= template.cloneNode(true);
          node.firstChild.src= "photos/photo-" + (photoIndex<10 ? ('0'+photoIndex) : photoIndex) + ".png";
          node.style.webkitTransform= TRANSLATE_OPEN + x + "px," + y + "px" + TRANSLATE_CLOSE;
          container.appendChild(node);
          // 
          // photos.push({
          //   src: "photos/photo-" + (photoIndex<10 ? ('0'+photoIndex) : photoIndex) + ".png",
          //   x: x * GRID_SIZE_H,
          //   y: y * GRID_SIZE_V,
          //   w: GRID_SIZE_H,
          //   h: GRID_SIZE_V
          // });
        }
        
        return photos;
      }
      
      distil.onready(function(){
    
        NIB('scrollview', {
          
          delegate: {
            scrollViewDidScroll: function(scrollView)
            {
              var x= Math.floor(Math.abs(scrollView.x) / GRID_SIZE_H);
              var y= Math.floor(Math.abs(scrollView.y) / GRID_SIZE_V);
              
              if (this.x==x && this.y==y)
                return;
                
              this.x= x;
              this.y= y;
              
              
              console.log("tile: " + x + ", " + y);
            }
          },
          
          main: VIEW('.demo', {
            
            '#scroller': coherent.ScrollView({
              // directionalLockEnabled: true,
              desktopCompatibility: true,
              items: createPhotos(7,8, 56),
              hScrollbar: false,
              vScrollbar: false,
              delegate: REF('delegate')
            })
            
          }),
          
          owner: {
            view: REF('main')
          }
          
        });
        
        var controller= new coherent.ViewController({
          nibName: 'scrollview'
        });
        
        controller.view();
        // createPhotosAlt(81,56);
      });
    </script>

  </body>
</html>